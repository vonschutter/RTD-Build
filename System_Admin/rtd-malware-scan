#!/bin/bash
PUBLICATION="RuntimeData Virus Scan Tool for Ubuntu"
VERSION="1.10"
#
#	RTD Ubuntu + derivatives software 
#   	Stephan, Sweden
#	Nate B. Buffalo Center, IA
#
#
#
# The purpose of this script is to make is simpler to scan a folder directly from cli.
#

###########################################################################
##                                                                       ##
##                       Set Environment                                 ##
##                                                                       ##
###########################################################################
#


# Set colors for prompting on screen.
	YELLOW="\033[1;33m"
	RED="\033[0;31m"
	ENDCOLOR="\033[0m"
	GREEN="\033[0;32m"
	BLUE="\033[0;34m"

# Display startup message
echo -e $YELLOW"$PUBLICATION $VERSION" $ENDCOLOR

# Set the location of the quarantined files
QUARANINE=./VIRUS
if [ ! -d "$QUARANINE" ]; then
	mkdir "$QUARANINE"
fi

# set the location of the log file
CLAMSCANLOGFILE=~/clamscan.log

SCANDIR=$@

###########################################################################
##                                                                       ##
##                            Check prereq                               ##
##                                                                       ##
###########################################################################
#
# Check it the program is installed and otherwise install it...
runifthere() {
    if hash clamscan 2>/dev/null; then
	#Check and see if Quarantene zone is there and scan home. 
	if [ -d "$QUARANINE" ]; then
	  clamscan $SCANDIR -r -a -i -l $CLAMSCANLOGFILE --bytecode=yes --stdout  --phishing-sigs --bell --algorithmic-detection=yes --move="$QUARANINE" 
	else
	  echo "$QUARANINE" not found! Is this folder writable?
	fi
	 
    else
        echo "You seem to have no clamav... I will try to get it... "
        echo "I will need to become admin to do that..."
        sudo apt install clamav
            if [ $? != 0 ];
            then
                echo "That install didn't work out so well."
                echo "Please manually try to add the software since I couldn't do it."
                exit
            fi
        echo "OK kindly try again!"
    fi
}





###########################################################################
##                                                                       ##
##                            Execute                                    ##
##                                                                       ##
###########################################################################
#
# Display sumary
echo " "
echo ___________________________________________________
echo " "
echo "[   Setting    ] [           Value             ]"
echo " Logging to:         $CLAMSCANLOGFILE"
echo " Quarantine in:      $QUARANINE"
echo " "
echo ___________________________________________________
echo " "
echo " Starting scan...."
echo " Scanning folder: $@"

# Run the scan function
runifthere



