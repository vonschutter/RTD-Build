#
#::                     S O F T W A R E    R E C I P I E S 
#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
#:: Author(s):   	SLS, KLS, NB.  Buffalo Center, IA & Avarua, Cook Islands
#:: Version 1.01
#::
#::
#::	Purpose: To define how software is added in one place. 
#::		 Software may be downloaded and installed manually, or via package manager or snaps. 
#::		 Configuration items are also defined here. 
#::	Usage: call this file using the "source" statment in bash. Then simply invoke the relevan recipie (funclion)
#::
#::	This script is shared in the hopes that
#::	someone will find it usefull.
#::
#::
#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
#
#	NOTE:	This terminal program is written and documented to a very high degree. The reason for doing this is that
#		these apps are seldom changed and when they are, it is usefull to be able to understand why and how 
#		things were built. Obviously, this becomes a useful learning tool as well; for all people that want to 
#		learn how to write admin scripts. It is a good and necessary practice to document extensively and follow
#		patterns when building your own apps and config scripts. Failing to do so will result in a costly mess
#		for any organization after some years and people turnover. 
#
#		As a general rule, we prefer using functions extensively because this makes it easier to manage the script
#		and facilitates several users working on the same scripts over time.
#
#
#	RTD admin scrips are placed in /opt/rtd/scripts. Optionally scripts may use the common
#	functions in _rtd_functions and _rtd_recipies. 
#	  _rtd_functions -- contain usefull admin functions for scripts, such as "how to install software" on different systems. 
#	  _rtd_recipies  -- contain software installation and configuration "recipies". 
#	Scripts may also be stand-alone if there is a reason for this. 
#
#	Taxonomy of this script: we prioritize the use of functions over monolithic script writing, and proper indentation
#	to make the script more readable. Each function shall also be documented to the point of the obvious.
#	Suggested function structure per google guidelines:
#
#	function_name () {
#		# Documentation and comments... 
#		...code...
#	}
#
#	We also like to log all activity, and to echo status output to the screen in a frienly way. To accomplish this,
#	the table below may be used as appropriate: 
#
#				OUTPUT REDIRECTION TABLE
#
#		  || visible in terminal ||   visible in file   || existing
#	  Syntax  ||  StdOut  |  StdErr  ||  StdOut  |  StdErr  ||   file   
#	==========++==========+==========++==========+==========++===========
#	    >     ||    no    |   yes    ||   yes    |    no    || overwrite
#	    >>    ||    no    |   yes    ||   yes    |    no    ||  append
#	          ||          |          ||          |          ||
#	   2>     ||   yes    |    no    ||    no    |   yes    || overwrite
#	   2>>    ||   yes    |    no    ||    no    |   yes    ||  append
#	          ||          |          ||          |          ||
#	   &>     ||    no    |    no    ||   yes    |   yes    || overwrite
#	   &>>    ||    no    |    no    ||   yes    |   yes    ||  append
#	          ||          |          ||          |          ||
#	 | tee    ||   yes    |   yes    ||   yes    |    no    || overwrite
#	 | tee -a ||   yes    |   yes    ||   yes    |    no    ||  append
#	          ||          |          ||          |          ||
#	 n.e. (*) ||   yes    |   yes    ||    no    |   yes    || overwrite
#	 n.e. (*) ||   yes    |   yes    ||    no    |   yes    ||  append
#	          ||          |          ||          |          ||
#	|& tee    ||   yes    |   yes    ||   yes    |   yes    || overwrite
#	|& tee -a ||   yes    |   yes    ||   yes    |   yes    ||  append
#
#	Our scripts are also structured in to three major sections: "settings", "functions", and "execute". 
#	Settings, contain configurable options for the script. Functions, contain all functions. Execute, 
#	contains all the actual logic and flow control of the script. 
#
#
#
# 	*		--- Installing software from the snap repository is prefferred --- 		*
#
# Snap is a software deployment and package management system developed by Canonical for the Linux operating system. 
# The packages, called snaps, and the tool for using them, snapd, work across a range of Linux distributions 
# allowing distribution-agnostic upstream software packaging. Snap application packages of software are self-contained 
# and work across a range of Linux distributions. This is unlike traditional Linux package  management approaches, 
# like APT or YUM, which require specifically adapted packages for each Linux distribution therefore adding delay between 
# application development and its deployment for end-users. 
#
# Supported distributions: 
# Arch Linux, CentOS, Debian, Fedora, Solus, Manjaro Linux, Linux Mint, OpenEmbedded, Raspbian, OpenWrt and openSUSE. 
#
# Security:
# Snaps are also contained from a security point of view and only have the access relly needed on a system. The user may
# add additional access descressionally. 
# 
# 	*	--- Installing software from the flathub repository is a secondary preferrence ---      *
#
# Flatpak (formerly xdg-app) is a software utility for software deployment and package management for Linux. It is advertised 
# as offering a sandbox environment in which users can run application software in isolation from the rest of the system.
# Applications using Flatpak need permissions to have access to Bluetooth, sound (with PulseAudio), network, files, etc., 
# permissions that are defined by the maintainer of the Flatpak and can be controlled (added or removed) by users on their 
# system.Flatpak was developed as part of the freedesktop.org project (formerly known as X Desktop Group or XDG) and was 
# originally called xdg-app.
#
# Flathub, a repository (or remote source in the Flatpak terminology) that is located at flathub.org, has become the de facto 
# standard for getting applications packaged with Flatpak.[9] Packages are added to it by both the Flathub administrators and 
# the developers of the programs themselves (though the admins have stated their preference for developer-submitted apps).
# Although Flathub is the de facto source for applications packaged with Flatpak, Flatpak can work independently of Flathub;
# it is possible to host a remote and access to remotes that are totally independent of Flathub.
#
#	*	---       Installing software from native distribution repositories  ----		*
#
# A Linux repository is a storage location from which your system retrieves and installs OS updates and applications. 
# Each repository is a collection of software hosted on a remote server and intended to be used for installing and updating 
# software packages on Linux systems. When you run commands such as “sudo apt update” or “sudo apt upgrade”, you may be pulling 
# package information and package updates from a number of repositories. 
# 
# For more information on package managers see: https://en.wikipedia.org/wiki/Package_manager
#
#	*	---       PREFFERRED Software install (Security + Control)           ----		*
# 
#  CAPABILITY TABLE:
# +-----------------------------------------------------+-----------------------------------+-----------------------------------+----------------------+
# | Features                                            | Snap                              | Flatpak                           | AppImage             |
# +-----------------------------------------------------+-----------------------------------+-----------------------------------+----------------------+
# | Permission Controls Toggles                         | Yes                               | Yes                               | No                   |
# | Sandboxing Support                                  | Yes                               | Yes                               | Yes                  |
# | Sandboxing Mandatory                                | Yes                               | Yes                               | No                   |
# | App Portability                                     | Yes                               | Yes                               | No                   |
# | Native Theme Support                                | Yes (with caveats)                | Yes (with caveats)                | Yes (with caveats)   |
# | Support for Bundled Libraries                       | Yes                               | Yes                               | Yes                  |
# | Fully Contained Single Executable Support           | No                                | No                                | Yes                  |
# | Online App Store                                    | Yes                               | Yes                               | Yes                  |
# | Multi-version Parallel Apps Support                 | Yes                               | Yes                               | Yes                  |
# | Automatic Updates                                   | Yes                               | Yes                               | Yes(with caveats)    |
# | Support for Chrome OS (through Crostini containers) | Yes                               | Yes                               | Yes                  |
# | App Size                                            | Can vary but higher than AppImage | Can vary but higher than AppImage | Lowest               |
# | Number of Applications Available in the App Store   | Highest                           | Lowest                            | Somewhere in between |
# | Plugins for Desktop App Store Software              | Yes                               | Yes                               | No                   |
# +-----------------------------------------------------+-----------------------------------+-----------------------------------+----------------------+
#
# 
#
# A new way to manage native packages on Linux PackageKit. PackageKit is a free and open-source suite of software 
# applications designed to provide a consistent and high-level front end for a number of different package management systems.
# PackageKit simplifies how to manage software on several different linux distribution and may even be available on BSD flavors. 
#
# TEMPLATE: For adding a new manu entry for a singel package or bundle of software:
#
# recipie_Bundle_descriptive_name () {
# 			# function documentaton... 
# 			# Echo to terminal:
# 			write_error		: Prints an error message to terminal in RED
# 			write_host 		: Prints a message to the terminal w. a choice of color
# 			write_information 	: Prints a message to the terminal in BLUE
# 			write_status		: Prints a message to the terminal in GREEN
# 			write_warning 		: Prints a message to the terminal in YELLOW
#
# 			# Install software with distribution package manager (Agnostic)
# 			for i in package1 package2 package3 ; do
# 			     InstallSoftwareFromRepo $i
# 			done
#
# 			# Install faltpacks:
# 			ensure_flatpack_package_managment
# 			snap install package-name
#
# 			# Install snap packages:
# 			ensure_snap_package_managment
# 			flatpack install 
#
# 			# Check a dependency:
# 			check_dependencies package-name
# }

# Add several software items that are almost alwasys used 
# in one way or another... 

# Set account on GIT Hub to fetch items from. 
GIT_Profile=${GIT_Profile:-vonschutter}



recipie_Bundle_Common_Apps () {
		# Add several software items that are almost alwasys used 
		# in one way or another... 
			echo -e $YELLOW"--- Adding some minor congiguration items for productivity..." $ENDCOLOR
			for i in diodon polari filezilla
			do
			     InstallSoftwareFromRepo $i
			done

			# Ensure Flatpack support
			check_dependencies flatpak

			# Ensure Snap support
			check_dependencies snapd

			# Configure Desktop software managers depending on desktop used
			case "$DESKTOP_SESSION" in
				plasma )
					check_dependencies plasma-discover
					check_dependencies plasma-discover-backend-flatpak
					check_dependencies plasma-discover-backend-snap
				;;
				* )
					snap install snap-store
					check_dependencies gnome-software
					check_dependencies gnome-software-plugin-flatpak
					check_dependencies gnome-software-plugin-snap
				;;
			esac
}



recipie_Remove_non_western_latin_fonts () {
	rtd_oem_remove_non_western_latin_fonts
}


recipie_Brave_Browser () {
		# This function will add the vendor maintained repository and install the software
		# using the distribution speciffic installers.
		echo -e $YELLOW"--- Installing Brave Browser directly from vendor repo..." $ENDCOLOR
		if cat "/etc/os-release" | grep "debian" ; then
			apt install -y apt-transport-https curl gnupg
			curl -s https://brave-browser-apt-release.s3.brave.com/brave-core.asc | apt-key --keyring /etc/apt/trusted.gpg.d/brave-browser-release.gpg add -
			echo "deb [arch=amd64] https://brave-browser-apt-release.s3.brave.com/ stable main" | tee /etc/apt/sources.list.d/brave-browser-release.list
			apt update
			apt install brave-browser -y
			return $?
		elif cat "/etc/os-release" | grep "fedora" ; then
			dnf install dnf-plugins-core -y
			dnf config-manager --add-repo https://brave-browser-rpm-release.s3.brave.com/x86_64/
			rpm --import https://brave-browser-rpm-release.s3.brave.com/brave-core.asc
			dnf install brave-browser -y
			return $?
		elif  cat "/etc/os-release" | grep "suse" ; then
			zypper install curl -y
			rpm --import https://brave-browser-rpm-release.s3.brave.com/brave-core.asc
			zypper addrepo https://brave-browser-rpm-release.s3.brave.com/x86_64/ brave-browser
			zypper install brave-browser -y
			return $?
		else 
			echo "${FUNCNAME[0]}: Neither debian, fedora, or suse base distros could be found; NOT installing brave."
			return 1
		fi
}



recipie_Vivaldi_Browser (){
		# # This function uses the RTD function "dl" to download a distribution speciffic package directly
		# # from the vendors website. It will work until the vendor removes the exact file... 
		# echo -e $YELLOW"--- Installing Vivaldi directly from vivaldi.com..." $ENDCOLOR
		echo -e $YELLOW"--- Installing Brave Browser directly from vendor repo..." $ENDCOLOR
		if cat "/etc/os-release" | grep "debian" ; then
			apt -y install wget gnupg2 software-properties-common
			wget -qO- https://repo.vivaldi.com/archive/linux_signing_key.pub | sudo apt-key add -
			echo 'deb https://repo.vivaldi.com/archive/deb/ stable main' | sudo tee /etc/apt/sources.list.d/vivaldi.list
			apt update
			apt install vivaldi-stable -y
			return $?
		elif cat "/etc/os-release" | grep "fedora" ; then
			dnf install dnf-utils -y
			dnf config-manager --add-repo https://repo.vivaldi.com/archive/vivaldi-fedora.repo
			dnf install vivaldi-stable -y
			return $?
		elif  cat "/etc/os-release" | grep "suse" ; then
			zypper install curl
			dl https://downloads.vivaldi.com/stable/vivaldi-stable-3.5.2115.81-1.x86_64.rpm 2>>$_ERRLOGFILE
			return $?
		else 
			echo "${FUNCNAME[0]}: Neither debian, fedora, or suse base distros could be found; NOT installing vivaldi."
			return 1
		fi
}


recipie_Windows_Subsystem_for_Linux (){
			InstallSoftwareFromRepo wine
}


recipie_Simplenote (){
			# some small simple apps you will like... 
			check_dependencies snapd
			# A simple to use not taking app that auto syncs with the same app on any device.
			snap install simplenote 2>>$_ERRLOGFILE

}



recipie_DOS_VM_for_Classic_Games (){
			# some small simple apps you will like... 
			check_dependencies snapd
			# A small app that allows you to use your old DOS software. 
			snap install dosbox-x  2>>$_ERRLOGFILE

}



recipie_Bundle_Screenshot_Tools (){
			# some small simple apps you will like... 
			check_dependencies snapd
			# Feature rich screenshot tool and screenshot annotation tool. Great for support.
			snap install screencloud  2>>$_ERRLOGFILE
			snap install flameshot-app 2>>$_ERRLOGFILE

}



recipie_Bundle_OEM_restricted_fonts () {
			# Download and install Trutype font pack... these are propietary and require passphrase to unlock. 
			wget --show-progress "https://www.dropbox.com/s/7n5dgltnddtrs9j/True_Type_Font_Pack.7z" -P /opt/rtd/cache/
			mkdir -p /usr/share/fonts/truetype/oem
			check_dependencies p7zip-full
			7z e -y /opt/rtd/cache/True_Type_Font_Pack.7z -o/usr/share/fonts/truetype/oem/

}



recipie_Bundle_Secure_Communication () {
			ensure_snap_package_managment
			snap install signal-desktop 
			snap install telegram-desktop 
}



recipie_Bundle_Video_Editing () {
			ensure_snap_package_managment
			snap install vidcutter 
			snap install handbrake-jz
			snap install matroska-tools
			snap install kdenlive
			snap install shotcut --classic
			snap install obs-studio
				snap connect obs-studio:alsa
				snap connect obs-studio:audio-record
				snap connect obs-studio:avahi-control
				snap connect obs-studio:camera
				snap connect obs-studio:jack1
				snap connect obs-studio:kernel-module-observe
				snap connect obs-studio:avahi-control
				snap connect obs-studio:kernel-module-observe
					if check_dependencies v4l2loopback-dkms ; then 
						if check_dependencies v4l2loopback-utils ; then 
							echo "options v4l2loopback devices=1 video_nr=13 card_label='OBS Virtual Camera'    exclusive_caps=1" | sudo tee /etc/modprobe.d/v4l2loopback.conf
							echo "v4l2loopback" | sudo tee /etc/modules-load.d/v4l2loopback.conf
							sudo modprobe -r v4l2loopback
							sudo modprobe v4l2loopback devices=1 video_nr=13 card_label='OBS Virtual Camera' exclusive_caps=1
						fi
					fi
				snap connect obs-studio:removable-media
				snap connect obs-studio:raw-usb
				snap connect obs-studio:joystick
				sudo snap install blender --classic
			
			ensure_flatpack_package_managment
			flatpak install flathub org.openshot.OpenShot --noninteractive -y 
			flatpak install flathub io.github.jliljebl.Flowblade --noninteractive -y 
}




recipie_Developer_Software (){
			write_status "--- Adding Developer Software Apps: IDE Tools and Compilers..." 
			for i in build-essential git
			do
			     InstallSoftwareFromRepo $i
			done
			check_dependencies snapd
			snap install atom --classic  
			snap install gitkraken --classic 
			sudo snap install code --classic 
}



recipie_Bundle_Compression_Tools (){
			write-status "--- Adding Comression Toolset (zip, 7zip rar etc.)..."
			for i in p7zip-full p7zip-rar rar zip 
			do
			     InstallSoftwareFromRepo $i
			done
}



recipie_Bundle_Curated_Top_Games (){
			# Install games from native repositories... 
			write_status "--- Adding Selection of Quality Games..." 
						
			# --- Install games available in SNAP repository --- 
			check_dependencies snapd
			for i in supertuxkart 0ad warzone2100 supertuxkart marsshooter mc-installer
			do
			     snap install $i
			done
			
			# --- Install games available in Flathub repository and not at Snapcrafters --- 
			check_dependencies flatpak
			
			# Add the flatpack repository if it down not already exist:
			flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
			
			# Add requested games:
			flatpak install flathub com.moddb.TotalChaos -y	--noninteractive
			flatpak install flathub com.viewizard.AstroMenace -y --noninteractive
			flatpak install flathub io.github.EndlessSky.endless-sky -y --noninteractive
			flatpak install flathub com.albiononline.AlbionOnline -y --noninteractive
			flatpak install flathub com.endlessnetwork.aqueducts -y --noninteractive
			flatpak install flathub de.billardgl.Billardgl -y --noninteractive
			flatpak install flathub org.naev.Naev -y --noninteractive
			
			# --- Install games available in repository only --- 
			for i in dreamchess armagetronad mesa-utils assaultcube openarena
			do
			     InstallSoftwareFromRepo $i
			done
			# Install Valves Steam Client for gaming. 
			InstallSoftwareFromRepo steam
			if [ $? != 0 ]; then 
				if hash rpm &>/dev/null; then
					dl https://steamcdn-a.akamaihd.net/client/installer/steam.rpm
				elif hash apt &>/dev/null; then
				
					dl https://steamcdn-a.akamaihd.net/client/installer/steam.deb 
				else
					echo -e $RED
					echo "I am not sure how to find the Steam download for $(lsb_release -sd) "
					echo "Please try to download it manually and instrtall it from the website:"
					echo "https://store.steampowered.com/about/"
					echo -e $ENDCOLOR
				fi
			fi
}





recipie_Bundle_Admin_Tools (){
			write_status "--- OEM System Administrative Tools..."
			# Loop through each item in this list of software and perform an install 
			# using the relevant packaging system. 
			for i in terminix nmap synaptic ssh gparted sshfs htop iftop nethogs vnstat ifstat dstat nload glances bmon \
				vim vim-scripts gufw variety remmina remmina-plugin-exec remmina-plugin-secret remmina-plugin-vnc remmina-plugin-nx  \
				remmina-plugin-spice remmina-plugin-xdmcp remmina-plugin-rdp remmina-plugin-telepathy  

			do
			     InstallSoftwareFromRepo $i
			done

}



recipie_Java_Runtime (){
			# Special case for installing Oracle Java...
			echo -e $YELLOW"--- Adding Java JRE..." $ENDCOLOR
			# Add the Oracle Java repository and install the software. 
			# add-apt-repository ppa:linuxuprising/java -y  1>>$_LOGFILE 2>>$_ERRLOGFILE
			# apt-get update  1>>$_LOGFILE 2>>$_ERRLOGFILE
			# echo oracle-java11-installer shared/accepted-oracle-license-v1-2 select true | sudo /usr/bin/debconf-set-selections && \
			# apt install -y oracle-java12-installer    1>>$_LOGFILE 2>>$_ERRLOGFILE
			# apt install -y oracle-java12-set-default  1>>$_LOGFILE 2>>$_ERRLOGFILE
			InstallSoftwareFromRepo default-jre

}



recipie_Bleachbit_System_Cleaner (){
			#Bleachbit
			write_status "--- Bleachbit System Cleaning Tool..." 
			InstallSoftwareFromRepo bleachbit 
}



recipie_Restricted_Fonts_and_Codecs (){
			echo -e $YELLOW"--- Install all the required multimedia codecs..." $ENDCOLOR
			# Auto accept microsoft corefonts eula
			echo ttf-mscorefonts-installer msttcorefonts/accepted-mscorefonts-eula select true | /usr/bin/debconf-set-selections
			for i in libdvdcss2 ffmpeg ubuntu-restricted-extras
			do
			     InstallSoftwareFromRepo $i
			done		
}



recipie_VLC_Universal_Videao_Player (){
			#VLC Media Player
			echo -e $YELLOW"--- Installing VLC Media Player..." $ENDCOLOR
			InstallSoftwareFromRepo vlc
}



recipie_Google_Chrome_Browser (){
			# Special case for installing Google Chrome
			echo -e $YELLOW"--- Installing Google Chrome Browser from google directly..." $ENDCOLOR
			dl https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb  1>>$_LOGFILE 2>>$_ERRLOGFILE
}



recipie_Remote_Desktop_by_Team_Viewer (){
			#Teamviewer
			echo -e $YELLOW"--- Installing Teamviewer..." $ENDCOLOR
			dl https://download.teamviewer.com/download/linux/teamviewer_amd64.deb  1>>$_LOGFILE 2>>$_ERRLOGFILE
}



recipie_Remote_Desktop_by_Anydesk () {
			check_dependencies flatpak
			flatpak install flathub com.anydesk.Anydesk --noninteractive -y 
}



recipie_Skype_Messenger (){
			#Skype for Linux
			write_status "--- Installing Skype For Linux..."
			check_dependencies snapd
			snap install skype --classic  2>>$_ERRLOGFILE
}



recipie_Viber_Messenger (){
			check_dependencies snapd
			snap install --edge viber-mtd 
}



recipie_MEGA.nz_Encrypted_Cloud_Storage (){
			# Special case for installing MEGA nz file sync utility (better than Drop Box)...
			write_status "--- Installing MEGA nz file crypto sync utility..." 
			check_dependencies lsb-release

			# Reset & clear variables in case of incomplete cleanup... 
			FILE2GET=
			URL=
			
			if lsb_release -si | grep "Debian" ; then
				URL="https://mega.nz/linux/MEGAsync/$(lsb_release -si)_$(lsb_release -sr).0/amd64/megasync-$(lsb_release -si)_$(lsb_release -sr).0_amd64.deb"
			elif lsb_release -si | grep "Ubuntu" ; then
				URL="https://mega.nz/linux/MEGAsync/xUbuntu_`lsb_release -sr`/amd64/megasync-xUbuntu_`lsb_release -sr`_amd64.deb"
			elif lsb_release -si | grep "openSUSE" ; then
				URL="https://mega.nz/linux/MEGAsync/openSUSE_Leap_15.0/x86_64/megasync-openSUSE_Leap_15.0.x86_64.rpm"
			else
				echo -e $RED
				echo "I am not sure how to find the Mega sync download for $(lsb_release -sd) "
				echo "Please try to download it manually and instrtall it from the website:"
				echo "https://mega.nz/sync"
				echo -e $ENDCOLOR
			fi

			
			# If a known distributio was found and URL set, use "dl" function to install app...
			[[ ! -z "$URL" ]] && dl $URL 1>>$_LOGFILE 2>>$_ERRLOGFILE
}



recipie_Dropbox_Corporate_Cloud_Storage (){
			# Install Dropbox
			write_status "--- Installing Dropbox Cloud Storage Sync..." 
			InstallSoftwareFromRepo nautilus-dropbox
}







recipie_Bundle_Media_Streamers:_Spotify_Wins_Google (){
			write_status "--- Installing Music Players and Audio Software..." 
			check_dependencies snapd
			snap install spotify  2>>$_ERRLOGFILE
			snap install google-play-music-desktop-player  2>>$_ERRLOGFILE
			snap install winds 2>>$_ERRLOGFILE

}



recipie_Bundle_Audio_Tools (){
			write_status "--- Installing Audio Tools Bundle..."
			ensure_snap_package_managment
			snap install picard  2>>$_ERRLOGFILE

}



recipie_Virtualbox (){
			# Install Virtual Box from Oracle. However avoid installing it in a VM, as tis usecase may be counterproductive.
			# NOTE:
			# VirtualBox is a powerful x86 and AMD64/Intel64 virtualization product for enterprise as well as 
			# home use. Not only is VirtualBox an extremely feature rich, high performance product for enterprise 
			# customers, it is also the only professional solution that is freely available as Open Source Software 
			# under the terms of the GNU General Public License (GPL) version 2. See "About VirtualBox" for an introduction.
			# Presently, VirtualBox runs on Windows, Linux, Macintosh, and Solaris hosts and supports a large number 
			# of guest operating systems including but not limited to Windows (NT 4.0, 2000, XP, Server 2003, Vista, Windows 7, 
			# Windows 8, Windows 10), DOS/Windows 3.x, Linux (2.4, 2.6, 3.x and 4.x), Solaris and OpenSolaris, OS/2, and OpenBSD.
			# VirtualBox is being actively developed with frequent releases and has an ever growing list of features, 
			# supported guest operating systems and platforms it runs on. VirtualBox is a community effort backed by a 
			# dedicated company: everyone is encouraged to contribute while Oracle ensures the product always meets professional 
			# quality criteria. 
			# 
			check_dependencies virt-what
			if virt-what ; then 
				# Special case for installing VirtualBox
				echo -e $YELLOW"--- Installing VirtualBox if available..." $ENDCOLOR
				echo virtualbox virtualbox/module-compilation-allowed boolean true | /usr/bin/debconf-set-selections
				echo virtualbox virtualbox/delete-old-modules boolean true | /usr/bin/debconf-set-selections
				# Loop through each item in this list of softwar and perform an install 
				# using the relevant packaging system. 
				for i in virtualbox virtualbox-dkms virtualbox-ext-pack virtualbox-guest-additions-iso 
				do
				InstallSoftwareFromRepo $i
				done
				[[ "$DESKTOP_SESSION" == "plasma" ]] || InstallSoftwareFromRepo virtualbox-qt
				# Ensure that the current user can use USB etc... 			
				if id -nG "$SUDO_USER" | grep -qw "vboxusers"; then
				echo      $SUDO_USER already belongs to vboxusers group
				else
				usermod -G vboxusers -a $SUDO_USER 1>>$_LOGFILE 2>>$_ERRLOGFILE
				fi
			else
				write_warning "This computer is likely a Virtual Macine (VM) and using Virtualbox inside a VM is not reccommended."
			fi
}



recipie_RTD_OEM_Configuration_and_Optimizations (){
			echo "Applying OEM Configuration..."
			#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
			#::::::::::::::                                          ::::::::::::::::::::::
			#::::::::::::::          Desktop Settings                ::::::::::::::::::::::
			#::::::::::::::                                          ::::::::::::::::::::::
			#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
			enable_firewall
			# Power managment profile
			check_dependencies tuned
			systemctl enable --now tuned
			tuned-adm profile balanced
			recipie_baseapps

			rtd_oem_check_splash () {
				if -f $1 ; then 
					if cat $1 |grep "-desktop" ; then
						InstallSoftwareFromRepo splash && echo 'GRUB_CMDLINE_LINUX_DEFAULT="quiet splash"'>> /etc/default/grub
						update-grub
					fi
				fi
			}
			# If this system was built using the RTD process and is debian based, use instructions in said file.
			rtd_oem_check_splash /opt/rtd/log/preseed.cfg

			#Tune to virtual machine guest or tune according to hardware type::
			check_dependencies virt-what
			check_dependencies laptop-detect
			if virt-what ; then 
				echo "This is likely not running in a virtual machine."
				if laptop-detect ; then 
					tuned-adm profile powersave
				else
					tuned-adm profile desktop
				fi
			else 
				tuned-adm profile virtual-guest 
			fi

			# Apply tweaks to the UI based on desktop active
			if  ps -e |grep "gnome-shell"; then
				write_information "Fonud the gnome UI on this system! Adding some customizations..."
				# Configure Gnome for OEM look and feel. This is completely as desired. 
				# These setings will then be copied to the "/etsc/skel" directory where user templates
				# are stored. This will allow new users to get the same themes and settings as the 
				# current user. This should likely only be done right after a PC has been installed
				# otherwise all user configuration settings will be trasferred to any user 
				# subsequently created.  
				# -------------------------------------------------------------------------------------------------------
				# Install Wallpapers and configure Gnome to see them. ...
				RTDCP=/opt/rtd/cache
				echo Downloading Wallpapers:
				echo ---------------------------------------------
				mkdir -p $RTDCP && wget -q --show-progress https://github.com/${GIT_Profile}/RTD-Media/archive/master.zip -P $RTDCP && unzip -q -o $RTDCP/master.zip -d $RTDCP
				rm $RTDCP/master.zip
				pushd $RTDCP && mv -f RTD-Media-master/Wallpaper .. && mv -f RTD-Media-master/Sound .. 
				echo ---------------------------------------------
				mkdir -p /usr/local/share/gnome-background-properties
				DIRECTORY=/opt/rtd/Wallpaper/
				ls $DIRECTORY > lspictures.txt

				# Make a header
				echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?>
				<!DOCTYPE wallpapers SYSTEM \"gnome-wp-list.dtd\">
				<wallpapers>" > mybackgrounds.xml
				# Registering all pictures in $DIRECTORY

					for i in $DIRECTORY*.jpg $DIRECTORY*.png; do
					echo "<wallpaper>
					<name>$i</name>
					<filename>$i</filename>
					<options>stretched</options>
					<pcolor>#8f4a1c</pcolor>
					<scolor>#8f4a1c</scolor>
					<shade_type>solid</shade_type>
					</wallpaper>" >> mybackgrounds.xml
					done

				# creating the footer
					echo "</wallpapers>" >> mybackgrounds.xml
					sed 's/<name>\/usr\/share\/backgrounds\//<name>/g' mybackgrounds.xml > /usr/local/share/gnome-background-properties/mybackgrounds.xml
					# cp /usr/local/share/gnome-background-properties/mybackgrounds.xml /usr/share/gnome-background-properties/mybackgrounds.xml
					rm mybackgrounds.xml ; rm lspictures.txt

				# Set the default wallpaper... 
					#run_command_in_gnome_user_session gsettings set org.gnome.desktop.background picture-uri file:///opt/rtd/Wallpaper/Wayland.jpg
					run_command_in_gnome_user_session gsettings set org.gnome.desktop.background picture-uri file:///opt/rtd/Wallpaper/Redmond.png
				# -------------------------------------------------------------------------------------------------------
				InstallSoftwareFromRepo gnome-tweak-tool
				# Special case for Fedora: Add the gnome UI tweak tool... 
				if cat /etc/os-release |grep "Fedora" &>> $_LOGFILE; then
					# Enable the extra repositories in fedora to get access to the espected software.
					InstallSoftwareFromRepo fedora-workstation-repositories 
				fi

				write_information "--- Optimizig look and feel of the desktop for productivity and aestetics..." 

				# Add Some clean and basic themes and icons...			
				for i in numix-gtk-theme numix-icon-theme \
					gnome-shell-extension-appindicator \
					gnome-shell-extension-suspend-button \
					gnome-shell-extension-log-out-button  \
					gnome-shell-extension-multi-monitors \
					gnome-shell-extension-caffeine \
					gnome-shell-extension-gsconnect  \
					gnome-shell-extension-gsconnect-browsers \
					gnome-shell-extension-dash-to-panel \
					gnome-shell-extension-dashtodock \
					arc-theme \
					adwaita-icon-theme-full adwaita-qt  
				do 
					InstallSoftwareFromRepo $i
				done

				if  cat /etc/os-release |grep "debian" &>/dev/null ; then 
					InstallSoftwareFromRepo gtk2-engines-murrine
					InstallSoftwareFromRepo gtk2-engines-pixbuf
					dl http://packages.linuxmint.com/pool/main/m/mint-y-icons/mint-y-icons_1.5.0_all.deb 
				elif /etc/os-release |grep "fedora" &>/dev/null; then
					InstallSoftwareFromRepo gtk-murrine-engine
					InstallSoftwareFromRepo gtk2-engines
				else 
					write_warning "This is not debian or fedora based! Not sure how ot proceed..."
				fi

				# Get and install the Vimix themes. 
				wget -q https://github.com/${GIT_Profile}/RTD-Media/raw/master/Themes/vimix-gtk-themes.zip -P /opt/rtd/cache
				wget -q https://github.com/${GIT_Profile}/RTD-Media/raw/master/Themes/vimix-icon-themes.zip -P /opt/rtd/cache
				unzip -q -o /opt/rtd/cache/vimix-gtk-themes.zip -d /opt/rtd/cache && pushd /opt/rtd/cache/vimix-gtk-themes-master && ./install.sh && popd
				unzip -q -o /opt/rtd/cache/vimix-icon-themes.zip -d /opt/rtd/cache && pushd /opt/rtd/cache/vimix-icon-theme-master && ./install.sh && popd

				cat >> gtweak.sh <<-'EOF'
				#!/bin/bash
				# Terminal and Tilix Dark Theme
				gsettings set com.gexperts.Tilix.Settings theme-variant 'dark'
				gsettings set org.gnome.Terminal.Legacy.Settings theme-variant 'dark'
				gsettings set org.gnome.Terminal.Legacy.Profile:/ use-transparent-background true
				gsettings set org.gnome.Terminal.Legacy.Profile:/ background-transparency-percent 50
				gsettings set org.gnome.Terminal.Legacy.Profile:/ default-size-columns 100
				gsettings set org.gnome.Terminal.Legacy.Profile:/ use-theme-transparency false
				gsettings set org.gnome.Terminal.Legacy.Profile:/ scrollback-lines 10000


				# Gnome Shell Theming
				# Add proffessional and crisp looking UI...
				gsettings set org.gnome.desktop.interface gtk-theme 'Arc'
				gsettings set org.gnome.desktop.interface icon-theme 'Mint-Y-Aqua'

				# Set font
				# gsettings set org.gnome.desktop.interface monospace-font-name 'Source Code Pro Semi-Bold 12'

				#Set Extensions for gnome
				gsettings set org.gnome.shell disable-user-extensions false
				gsettings set org.gnome.shell enabled-extensions "['user-theme@gnome-shell-extensions.gcampax.github.com', 'caffeine@patapon.info', 'TopIcons@phocean.net', 'dash-to-panel@jderose9.github.com']"

				# Configure dash-to-panel
				gnome-shell-extension-tool -e dash-to-panel
				gsettings set org.gnome.shell.extensions.dash-to-panel trans-use-custom-opacity 'true'


				#Better Font Smoothing
				gsettings set org.gnome.settings-daemon.plugins.xsettings antialiasing 'rgba'

				#Usability Improvements
				gsettings set org.gnome.desktop.peripherals.mouse accel-profile 'adaptive'
				gsettings set org.gnome.desktop.sound allow-volume-above-100-percent true
				gsettings set org.gnome.desktop.calendar show-weekdate true
				gsettings set org.gnome.desktop.wm.preferences resize-with-right-button true
				gsettings set org.gnome.desktop.wm.preferences button-layout 'appmenu:minimize,maximize,close'
				gsettings set org.gnome.shell.overrides workspaces-only-on-primary false

				# Configure Dash to Dock
				gsettings set org.gnome.shell.extensions.dash-to-dock click-action 'minimize'
				gsettings set org.gnome.shell.extensions.dash-to-dock dock-position 'BOTTOM'
				gsettings set org.gnome.shell.extensions.dash-to-dock apply-custom-theme false
				gsettings set org.gnome.shell.extensions.dash-to-dock custom-background-color false
				gsettings set org.gnome.shell.extensions.dash-to-dock custom-theme-customize-running-dots true
				gsettings set org.gnome.shell.extensions.dash-to-dock custom-theme-running-dots-color '#729fcf'
				gsettings set org.gnome.shell.extensions.dash-to-dock custom-theme-shrink true
				gsettings set org.gnome.shell.extensions.dash-to-dock dock-fixed false
				gsettings set org.gnome.shell.extensions.dash-to-dock extend-height true
				gsettings set org.gnome.shell.extensions.dash-to-dock force-straight-corner false
				gsettings set org.gnome.shell.extensions.dash-to-dock icon-size-fixed true
				gsettings set org.gnome.shell.extensions.dash-to-dock intellihide-mode 'ALL_WINDOWS'
				gsettings set org.gnome.shell.extensions.dash-to-dock isolate-workspaces true
				gsettings set org.gnome.shell.extensions.dash-to-dock show-apps-at-top true
				gsettings set org.gnome.shell.extensions.dash-to-dock unity-backlit-items false
				gsettings set org.gnome.shell.extensions.dash-to-dock transparency-mode 'FIXED'
				gsettings set org.gnome.shell.extensions.dash-to-dock running-indicator-style 'SEGMENTED'
				gsettings set org.gnome.shell.extensions.dash-to-dock background-opacity 0.70000000000000000
				gsettings set org.gnome.shell.extensions.dash-to-dock extend-height false
				#gnome-shell-extension-tool -e dash-to-dock

				#This indexer is nice, but can be detrimental for laptop users battery life
				gsettings set org.freedesktop.Tracker.Miner.Files index-on-battery false
				gsettings set org.freedesktop.Tracker.Miner.Files index-on-battery-first-time false
				gsettings set org.freedesktop.Tracker.Miner.Files throttle 15

				#Nautilus (File Manager) Usability
				gsettings set org.gnome.nautilus.icon-view default-zoom-level 'standard'
				gsettings set org.gnome.nautilus.preferences executable-text-activation 'ask'
				gsettings set org.gtk.Settings.FileChooser sort-directories-first true
				gsettings set org.gnome.nautilus.list-view use-tree-view true
				gsettings set org.gnome.nautilus.list-view default-zoom-level 'small'

				# Set the GNOME Shell Apps Dashboard sort app in categories based on the FreeDesktop standard.
				gsettings set org.gnome.desktop.app-folders folder-children "['accessories', 'chrome-apps', 'games', 'graphics', 'internet', 'office', 'programming', 'science', 'sound---video', 'system-tools', 'universal-access', 'wine']"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/accessories/ name "Accessories"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/accessories/ categories "['Utility']"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/chrome-apps/ name "Chrome Apps"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/chrome-apps/ categories "['chrome-apps']"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/games/ name "Games"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/games/ categories "['Game']"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/graphics/ name "Graphics"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/graphics/ categories "['Graphics']"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/internet/ name "Internet"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/internet/ categories "['Network', 'WebBrowser', 'Email']"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/office/ name "Office"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/office/ categories "['Office']"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/programming/ name "Programming"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/programming/ categories "['Development']"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/science/ name "Science"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/science/ categories "['Science']"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/sound---video/ name "Sound & Video"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/sound---video/ categories "['AudioVideo', 'Audio', 'Video']"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/system-tools/ name "System Tools"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/system-tools/ categories "['System', 'Settings']"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/universal-access/ name "Universal Access"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/universal-access/ categories "['Accessibility']"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/wine/ name "Wine"
				gsettings set org.gnome.desktop.app-folders.folder:/org/gnome/desktop/app-folders/folders/wine/ categories "['Wine', 'X-Wine', 'Wine-Programs-Accessories']"
				EOF

				run_command_in_gnome_user_session /bin/bash gtweak.sh 
			fi

			if  ps -e |grep "plasmashell" ; then
				echo "Detected KDE UI!" 
				
				# Download and Set Wallpaper... 
				RTDCP="${_RTDCACHE:="/opt/rtd/cache"}"
				echo Downloading Wallpapers:
					mkdir -p $RTDCP && wget -q --show-progress https://github.com/${GIT_Profile}/RTD-Media/archive/master.zip -P $RTDCP && unzip -q -o $RTDCP/master.zip -d $RTDCP
					rm $RTDCP/master.zip
					pushd $RTDCP && mv -f RTD-Media-master/Wallpaper .. && mv -f RTD-Media-master/Sound .. 
				rtd_oem_kde_set_wallpaper "/opt/rtd/Wallpaper/Wayland.jpg" 

				# Download HQ Icons
				dl http://packages.linuxmint.com/pool/main/m/mint-y-icons/mint-y-icons_1.5.0_all.deb 

				lookandfeeltool -a 'org.kde.breezedark.desktop'
				wget -q https://github.com/vinceliuice/vimix-kde/archive/master.zip -P /opt/rtd/cache
				unzip -q -o /opt/rtd/cache/master.zip -d /opt/rtd/cache && pushd /opt/rtd/cache/vimix-kde-master && ./install.sh && popd

				wget -q https://github.com/${GIT_Profile}/RTD-Media/raw/master/Themes/vimix-icon-themes.zip -P /opt/rtd/cache
				unzip -q -o /opt/rtd/cache/vimix-icon-themes.zip -d /opt/rtd/cache && pushd /opt/rtd/cache/vimix-icon-theme-master && ./install.sh && popd
			fi
}

